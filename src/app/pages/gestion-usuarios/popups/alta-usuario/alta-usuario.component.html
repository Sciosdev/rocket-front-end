<nb-card status="primary" class="overflow-auto" style="height: 100%; position: sticky;">
    <nb-card-header>Alta de usuario </nb-card-header>
    <nb-card-body>
        <div class="row mb-2">
            <div class="col-sm-6">
                <div class="d-flex justify-content-left">
                    <div class="p-2">
                        <img class="border border-secondary" [src]="imagePath" width="150px" height="150px"
                            *ngIf="usuario.foto" />
                        <div class="border border-secondary" style="width: 150px; height: 150px" *ngIf="!usuario.foto">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div>
                                    <div class="d-flex justify-content-center">
                                        <nb-icon icon="person-delete-outline" status="info" style="font-size: 3rem;">
                                        </nb-icon>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                        <span>Sin Foto</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-2">
                        <p-fileUpload #form name="myfile[]" accept="image/*" mode="basic" [auto]="true"
                            chooseLabel="Seleccionar imagen" chooseIcon="pi-search" uploadLabel="Cargar"
                            cancelLabel="Cancelar" [customUpload]="true" (uploadHandler)="myUploader($event, form)"
                            (onBeforeUpload)="onBeforeUpload()" (onUpload)="onUpload()"></p-fileUpload>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="row ">
                    <div class="col-sm-12 mb-3">
                        <label for="rol" class="label">Rol *</label>
                        <nb-form-field class="full-width">
                            <nb-select placeholder="Selecciona un rol" [formControl]="selectedRolFormControl"
                                [required]="true">
                                <nb-option>Sin Selección</nb-option>
                                <nb-option *ngFor="let rol of roles_combo" [value]="rol.rol">
                                    {{ rol.rol }}
                                </nb-option>
                            </nb-select>
                        </nb-form-field>
                        <ng-container
                            *ngIf="selectedRolFormControl.hasError('required') && this.selectedRolFormControl.dirty">
                            <p class="caption status-danger">
                                El rol es requerido.
                            </p>
                        </ng-container>
                    </div>

                    <div class="col-sm-12">
                        <label for="rol" class="label">Tienda</label>
                        <nb-form-field class="full-width">
                            <nb-select placeholder="Selecciona una tienda" [(ngModel)]="selectedTienda" name="tienda">
                                <nb-option>Sin Selección</nb-option>
                                <nb-option *ngFor="let tienda of tiendas_combo" [value]="tienda.id">
                                    {{ tienda.nombreTienda }}
                                </nb-option>
                            </nb-select>
                        </nb-form-field>
                    </div>
                </div>
            </div>
        </div>
        <hr />
        <span class="text-info font-weight-bold">Los campos marcados con * son requeridos</span>

        <div class="p-2">
            <form>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="inputFirstName" class="label">Nombre *</label>
                            <input type="text" nbInput fullWidth id="inputFirstName" placeholder="Nombre"
                                [value]="usuario.firstName | undefined" [(ngModel)]="usuario.firstName" name="firstName"
                                #nombre="ngModel" required />

                            <ng-container *ngIf="nombre.invalid && nombre.touched">
                                <p class="caption status-danger" *ngIf="nombre.errors?.required">
                                    Nombre es requerido!
                                </p>
                            </ng-container>
                        </div>

                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="inputLastName" class="label">Apellido Paterno</label>
                            <input type="text" nbInput fullWidth id="inputLastName" placeholder="Apellido Paterno"
                                [value]="usuario.lastName | undefined" [(ngModel)]="usuario.lastName" name="lastName" />
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="inputWebsite" class="label">Apellido Materno</label>
                            <input type="text" nbInput fullWidth id="inputWebsite" placeholder="Apellido Materno"
                                [value]="usuario.secondLastName | undefined" [(ngModel)]="usuario.secondLastName"
                                name="secondLastName" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="inputusername" class="label">Usuario *</label>
                            <input type="text" nbInput fullWidth id="inputusername" placeholder="Usuario"
                                [value]="usuario.user | undefined" [(ngModel)]="usuario.user" name="username"
                                #username="ngModel" required />

                            <ng-container *ngIf="username.invalid && username.touched">
                                <p class="caption status-danger" *ngIf="username.errors?.required">
                                    Usuario es requerido!
                                </p>
                            </ng-container>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="inputcontrasena" class="label">Contraseña *</label>
                            <nb-form-field>
                            <input [type]="getInputType()" nbInput fullWidth id="inputcontrasena" placeholder="Contraseña"
                                [value]="usuario.password | undefined" [(ngModel)]="usuario.password" name="contrasena"
                                #contrasena="ngModel" required>
                                <button nbSuffix nbButton ghost (click)="toggleShowPassword()">
                                    <nb-icon [icon]="showPassword ? 'eye-outline' : 'eye-off-2-outline'" pack="eva"
                                        [attr.aria-label]="showPassword ? 'hide password' : 'show password'">
                                    </nb-icon>
                                </button>
                            </nb-form-field>
                            <ng-container *ngIf="contrasena.invalid && contrasena.touched">
                                <p class="caption status-danger" *ngIf="contrasena.errors?.required">
                                    La contraseña es requerida!
                                </p>
                            </ng-container>
                        </div>
                    </div>
                    <div class="col-sm-6"></div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="inputconfcontrasena" class="label">Confirmación de contraseña *</label>
                            <nb-form-field>
                            <input  [type]="getCInputType()" nbInput fullWidth id="inputconfcontrasena" placeholder="Confirma contraseña"
                                [value]="confirmapassword | undefined" [(ngModel)]="confirmapassword"
                                name="confcontrasena" #confcontrasena="ngModel" required >
                                <button nbSuffix nbButton ghost (click)="toggleShowCPassword()">
                                    <nb-icon [icon]="showCPassword ? 'eye-outline' : 'eye-off-2-outline'" pack="eva"
                                        [attr.aria-label]="showCPassword ? 'hide password' : 'show password'">
                                    </nb-icon>
                                </button>
                            </nb-form-field>
                            <ng-container
                                *ngIf="(confcontrasena.invalid && confcontrasena.touched) || (confcontrasena.touched && confirmapassword !== usuario.password)">
                                <p class="caption status-danger" *ngIf="confcontrasena.errors?.required">
                                    La confirmación de contraseña es requerida!
                                </p>
                                <p class="caption status-danger" *ngIf="confirmapassword !== usuario.password">
                                    Las contraseñas no coinciden
                                </p>
                            </ng-container>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label for="inputEmail" class="label">Dirección</label>
                            <input type="email" nbInput fullWidth id="inputEmail" placeholder="Dirección"
                                [value]="usuario.address | undefined" [(ngModel)]="usuario.address" name="address" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="inputEmail" class="label">Correo</label>
                            <input type="email" nbInput fullWidth id="inputEmail" placeholder="Correo"
                                [value]="usuario.email | undefined" [(ngModel)]="usuario.email" name="email" />
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="inputEmail" class="label">Telefono</label>
                            <input type="email" nbInput fullWidth id="inputEmail" placeholder="Telefono"
                                [value]="usuario.phoneNumber | undefined" [(ngModel)]="usuario.phoneNumber"
                                name="phoneNumber" />
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="d-flex justify-content-end">
            <div class="p-2">
                <button mat-raised-button color="accent" matRipple (click)="accept()" [disabled]="selectedRolFormControl.hasError('required') || 
                    nombre.errors?.required ||  
                    username.errors?.required || 
                    contrasena.errors?.required || 
                    confcontrasena.errors?.required || 
                    confirmapassword !== usuario.password">
                    <nb-icon icon="checkmark-square-2-outline"></nb-icon>
                    Aceptar
                </button>
            </div>
            <div class="p-2">
                <button mat-raised-button color="primary" matRipple (click)="cancel()">
                    <nb-icon icon="close-square-outline"></nb-icon>
                    Cancelar
                </button>
            </div>
        </div>
    </nb-card-body>
</nb-card>